# ascfix

[![Tests & Lints](https://github.com/evoludigit/ascfix/actions/workflows/test.yml/badge.svg)](https://github.com/evoludigit/ascfix/actions/workflows/test.yml)
[![Security Audit](https://github.com/evoludigit/ascfix/actions/workflows/audit.yml/badge.svg)](https://github.com/evoludigit/ascfix/actions/workflows/audit.yml)
[![Crates.io](https://img.shields.io/crates/v/ascfix.svg)](https://crates.io/crates/ascfix)

Automatic ASCII diagram repair tool for Markdown files.

## Overview

**ascfix** fixes misaligned ASCII diagrams in Markdown, especially those generated by LLMs. It normalizes box widths, aligns arrows, enforces uniform padding, and ensures diagrams remain maintainable.

Ideal for:
- AI-generated documentation with ASCII diagrams
- Markdown files with workflow diagrams
- CI/CD pipeline documentation
- Architecture diagrams in code repositories

## Features

- **Safe mode**: Normalize Markdown tables (default)
- **Diagram mode**: Repair ASCII boxes and arrows
- **Check mode**: Validate files without modifying (exit codes for CI/CD)
- **Conservative**: Only fixes well-understood structures
- **Idempotent**: Running twice produces identical output
- **Fast**: Linear processing time
- **Safe**: No panics on untrusted input

## Installation

### From crates.io

```bash
cargo install ascfix
```

### From source

```bash
git clone https://github.com/evoludigit/ascfix.git
cd ascfix
cargo install --path .
```

## Usage

```bash
# Check a file (default: safe mode, output to stdout)
ascfix README.md

# Fix a file in place (default: safe mode)
ascfix README.md --in-place

# Enable diagram mode for box/arrow repair
ascfix README.md --in-place --mode=diagram

# Validate without modifying (check mode)
ascfix README.md --check --mode=diagram
# Returns exit code 1 if changes would be made

# Process multiple files
ascfix docs/*.md --in-place --mode=diagram
```

### Modes

| Mode | Description | Use Case |
|------|-------------|----------|
| `safe` | Fix only Markdown tables | Conservative, safe for any file |
| `diagram` | Fix boxes and arrows | For files with ASCII diagrams |
| `check` | Validate without writing | CI/CD validation |

## Examples

### Safe Mode: Markdown Table Alignment

**Before** (inconsistent column widths):
```markdown
| Name | Age | City |
|------|-----|----------|
| Alice | 30 | New York |
| Bob | 25 | Boston |
| Charlie | 35 | Chicago |
```

**After** (normalized columns):
```markdown
| Name    | Age | City      |
|---------|-----|-----------|
| Alice   | 30  | New York  |
| Bob     | 25  | Boston    |
| Charlie | 35  | Chicago   |
```

**Command:**
```bash
ascfix table.md --in-place
```

---

### Diagram Mode: Box and Arrow Alignment

**Before** (misaligned, inconsistent):
```markdown
      ↓
┌──────┐
│ Step │
└──────┘
    ↓
┌─────────┐
│ Process  │
└─────────┘
```

**After** (normalized):
```markdown
     ↓
┌────────┐
│ Step   │
└────────┘
     ↓
┌────────┐
│ Process│
└────────┘
```

**Command:**
```bash
ascfix workflow.md --in-place --mode=diagram
```

---

### Diagram Mode: Box Width Normalization

**Before** (text too close to border):
```markdown
┌────────┐
│Process │
└────────┘
```

**After** (proper padding):
```markdown
┌─────────┐
│ Process │
└─────────┘
```

---

### Diagram Mode: Complex Workflow

**Before** (AI-generated, misaligned):
```markdown
Source Code
    ↓
┌──────────────────┐
│ Build & Test     │
└──────────────────┘
  ↓
┌────────┐
│ Deploy │
└────────┘
```

**After** (normalized, consistent):
```markdown
Source Code
     ↓
┌─────────────────┐
│ Build & Test    │
└─────────────────┘
     ↓
┌──────────────────┐
│ Deploy           │
└──────────────────┘
```

---

### Check Mode: CI/CD Validation

**Validate without modifying** (useful for pull requests):
```bash
# Exit 0 if file is already normalized
# Exit 1 if file needs fixing
ascfix docs/*.md --check --mode=diagram
```

Perfect for GitHub Actions:
```yaml
- name: Check diagram alignment
  run: ascfix docs/*.md --check --mode=diagram
  # Fails the build if any diagrams need fixing
```

---

## Building & Testing

```bash
# Run all tests
cargo test

# Check code quality
cargo clippy --all-targets --all-features -- -D warnings

# Build release binary
cargo build --release
```

All code is tested with TDD discipline - unit tests, integration tests, and golden file tests.

## Documentation

- **[ARCHITECTURE.md](ARCHITECTURE.md)** - Design overview, module structure, and data flow
- **[SECURITY.md](SECURITY.md)** - Security policies, audit status, and best practices
- **[CONTRIBUTING.md](CONTRIBUTING.md)** - Development guidelines and contribution process
- **[CHANGELOG.md](CHANGELOG.md)** - Version history and release notes

## License

Licensed under the MIT License ([LICENSE](LICENSE) or https://opensource.org/licenses/MIT)

### Contribution

Contributions are welcome! Please feel free to submit pull requests.
